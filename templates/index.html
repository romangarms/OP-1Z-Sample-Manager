{% extends "base.html" %}

{%block stylesheets %}
<link rel="stylesheet" href="/static/css/index.css">
{%endblock%}

{%block title %}
<title>OP-Z/OP-1 Sample Manager</title>
{%endblock%}

{% block main %}
<h1>Teenage Engineering Sample Utility</h1>

<script>
    // make a request to "/get-config-setting?config_option=OPZ_MOUNT_PATH" to check if a mount path is set
    function checkMountPath() {
        fetch('/get-config-setting?config_option=OPZ_MOUNT_PATH')
            .then(response => response.json())
            .then(data => {
                if (data.config_value && data.config_value !== '') {
                    document.getElementById('mount-path-container').hidden = true;
                } else {
                    document.getElementById('mount-path').innerHTML = 'OP-Z mount path not set. Please select your OP-Z mount directory in <a href="/utilitysettings" class="btn btn-danger">Utility Settings</a>';
                }
            })
            .catch(error => {
                console.error('Error fetching mount path:', error);
                document.getElementById('mount-path').innerText = 'Error fetching mount path.';
            });
    }

    // Run on page load
    checkMountPath();

    // Run when window regains focus
    window.addEventListener('focus', checkMountPath);

    // Initialize Lucide icons
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
    });

    // Function to open external links in system browser
    function openExternalLink(url) {
        fetch(`/open-external-link?url=${encodeURIComponent(url)}`)
            .then(response => response.json())
            .catch(err => console.error('Error opening link:', err));
    }
</script>

<div id="mount-path-container" class="error-container container">
    <p id="mount-path">Checking OP-Z mount path...</p>
</div>

<div class="tile-grid">
    <!-- Row 1: Universal tools -->
    <a href="/sampleconverter" class="nav-tile tile-primary">
        <i data-lucide="audio-waveform"></i>
        <h3>Sample Converter</h3>
        <p>Convert audio files for OP-Z/OP-1</p>
    </a>

    <a href="/samplemanager" class="nav-tile tile-secondary">
        <i data-lucide="folder-open"></i>
        <h3>Sample Manager</h3>
        <p>Manage samples on your device</p>
    </a>

    <!-- Row 2: Device-specific + Backup -->
    <div class="tile-split">
        <a href="/configeditor" class="nav-tile tile-warning tile-half">
            <i data-lucide="file-edit"></i>
            <h3>Config Editor</h3>
            <p>Edit OP-Z configs</p>
            <span class="device-badge">OP-Z</span>
        </a>
        <a href="/tapeexport" class="nav-tile tile-white tile-half">
            <i data-lucide="download"></i>
            <h3>Tape Export</h3>
            <p>Export OP-1 tapes to Downloads</p>
            <span class="device-badge">OP-1</span>
        </a>
    </div>

    <a href="/backup" class="nav-tile tile-danger">
        <i data-lucide="hard-drive-download"></i>
        <h3>Backup & Restore</h3>
        <p>Backup samples and projects</p>
    </a>
</div>

<div class="footer-links">
    <a href="/utilitysettings" class="footer-link">
        <i data-lucide="settings"></i>
        Utility Settings
    </a>
    <span class="footer-separator"></span>
    <button onclick="openExternalLink('https://github.com/romangarms/opz-sample-manager')" class="footer-link">
        <i data-lucide="github"></i>
        View on GitHub
    </button>
</div>

{% endblock %}

</html>