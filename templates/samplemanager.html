{% extends "base.html" %}
{% from 'macros.html' import sample_category_pair, nav_button, device_tabs, error_container, loading_overlay %}

{%block stylesheets %}
<link rel="stylesheet" href="/static/css/samplemanager.css">
{%endblock%}

{%block title %}
<title>Sample Manager</title>
{%endblock%}

{% block main %}
<h1>Sample Manager</h1>
<p class="page-description">Drop any audio file into a slot for it to be automatically converted to the OP-1/OP-Z audio format and placed in the correct directory.</p>

<div class="header-row">
    {{ nav_button('/', 'Home', icon='home') }}
    {{ device_tabs() }}
    <button id="open-directory-btn" onclick="openDirectory()" class="nav-btn nav-btn-warning">
        <i data-lucide="folder-open"></i>
        Open Directory
    </button>
    <button onclick="openSettingsModal()" class="nav-btn nav-btn-secondary">
        <i data-lucide="settings"></i>
        Settings
    </button>
</div>

<div id="sample-output"></div>

{{ error_container() }}

<!-- OP-Z Container -->
<div id="opz-container" class="device-container">
    {{ loading_overlay('opz-loading', 'Loading samples...') }}
    <div id="opz-storage-info" class="storage-info">
        <div class="storage-section">
            <h4>Storage</h4>
            <div class="info-row">
                <span class="info-label">Used:</span>
                <span class="info-value" id="opz-storage-used">0 KB</span>
            </div>
            <div class="info-row">
                <span class="info-label">Free:</span>
                <span class="info-value" id="opz-storage-free">0 KB</span>
            </div>
        </div>

        <div class="storage-section">
            <h4>Usage</h4>
            <div class="info-row">
                <span class="info-label">Samples Used:</span>
                <span class="info-value" id="opz-samples-used">0</span>
            </div>
            <div class="storage-bar-container">
                <div class="storage-bar">
                    <div class="storage-bar-fill" id="opz-storage-bar-fill"></div>
                </div>
                <span class="storage-bar-label" id="opz-storage-bar-label">Storage: 0%</span>
            </div>
        </div>
    </div>

    <div id="opz-file-list" class="file-list">
        {{ sample_category_pair('1-kick', 'Kicks', '2-snare', 'Snares') }}
        {{ sample_category_pair('3-perc', 'Percussion', '4-fx', 'FX') }}

        <hr class="section-divider">

        {{ sample_category_pair('5-bass', 'Bass', '6-lead', 'Lead') }}
        {{ sample_category_pair('7-arpeggio', 'Arpeggio', '8-chord', 'Chords') }}
    </div>
</div>

<!-- OP-1 Container -->
<div id="op1-container" class="device-container" hidden>
    {{ loading_overlay('op1-loading', 'Loading samples...') }}
    <div id="op1-storage-info" class="storage-info">
        <div class="storage-section">
            <h4>Storage</h4>
            <div class="info-row">
                <span class="info-label">Used:</span>
                <span class="info-value" id="op1-storage-used">0 MB</span>
            </div>
            <div class="info-row">
                <span class="info-label">Free:</span>
                <span class="info-value" id="op1-storage-free">512 MB</span>
            </div>
        </div>

        <div class="storage-section">
            <h4>Usage</h4>
            <div class="info-row">
                <span class="info-label">Drum Samples:</span>
                <span class="info-value" id="op1-drum-samples">0 / 42</span>
            </div>
            <div class="info-row">
                <span class="info-label">Synth Samples:</span>
                <span class="info-value" id="op1-synth-samples">0 / 42</span>
            </div>
            <div class="info-row">
                <span class="info-label">Patches:</span>
                <span class="info-value" id="op1-patches">0 / 100</span>
            </div>
            <div class="storage-bar-container">
                <div class="storage-bar">
                    <div class="storage-bar-fill" id="op1-storage-bar-fill"></div>
                </div>
                <span class="storage-bar-label" id="op1-storage-bar-label">Storage: 0%</span>
            </div>
        </div>
    </div>

    <div id="op1-file-list" class="file-list">
        <!-- Drum Section -->
        <div class="op1-section" id="op1-drum-section">
            <div class="op1-section-header">
                <h3>Drum</h3>
                <button class="btn btn-small btn-secondary" onclick="createOp1Subdirectory('drum')">+ Add Folder</button>
            </div>
            <div class="op1-subdirectories" id="op1-drum-subdirectories">
                <!-- Subdirectories will be populated by JavaScript -->
            </div>
        </div>

        <!-- Synth Section -->
        <div class="op1-section" id="op1-synth-section">
            <div class="op1-section-header">
                <h3>Synth</h3>
                <button class="btn btn-small btn-secondary" onclick="createOp1Subdirectory('synth')">+ Add Folder</button>
            </div>
            <div class="op1-subdirectories" id="op1-synth-subdirectories">
                <!-- Subdirectories will be populated by JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="settingsModalTitle">Conversion Settings</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6>Pitch Correction</h6>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="setting-auto-pitch" checked>
                        <label class="form-check-label" for="setting-auto-pitch">
                            Auto-tune synth samples to nearest A note (A 440Hz)
                        </label>
                    </div>
                    <small class="text-muted">When enabled, synth samples will automatically be pitch-corrected to the nearest A note (110Hz, 220Hz, 440Hz, 880Hz, 1760Hz) for proper tuning on OP-1/OP-Z devices.</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/samplemanager.js"></script>
<script>
    // on page load, initialize device tabs and load samples
    document.addEventListener("DOMContentLoaded", function() {
        initDeviceTabs();
    });
</script>

{% endblock %}

</html>
